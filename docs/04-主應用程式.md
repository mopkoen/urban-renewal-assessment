# ä¸»æ‡‰ç”¨ç¨‹å¼ - App.tsx

## ğŸ“ æª”æ¡ˆä½ç½®

```
App.tsx
```

## ğŸ¯ åŠŸèƒ½èªªæ˜

`App.tsx` æ˜¯æ•´å€‹æ‡‰ç”¨ç¨‹å¼çš„æ ¸å¿ƒçµ„ä»¶ï¼Œè² è²¬ï¼š
- ç®¡ç†å…¨åŸŸç‹€æ…‹ï¼ˆè¼¸å…¥è³‡æ–™ã€èªè¨€ã€ä¸»é¡Œã€åˆ†é ï¼‰
- è™•ç†ä½¿ç”¨è€…è¼¸å…¥èˆ‡é©—è­‰
- æ¸²æŸ“åˆ†é å¼è¼¸å…¥ä»‹é¢
- æ•´åˆçµæœå±•ç¤ºçµ„ä»¶
- æä¾›è¨­å®šé¸å–®ï¼ˆèªè¨€ã€ä¸»é¡Œåˆ‡æ›ï¼‰

## ğŸ“ ç¨‹å¼ç¢¼çµæ§‹æ¦‚è¦½

### ä¸»è¦å€å¡Š

1. **å¼•å…¥èˆ‡è¨­å®š**ï¼ˆç¬¬ 1-18 è¡Œï¼‰
2. **é è¨­è³‡æ–™**ï¼ˆç¬¬ 20-78 è¡Œï¼‰
3. **ä¸»çµ„ä»¶å®šç¾©**ï¼ˆç¬¬ 87-383 è¡Œï¼‰
4. **ç‹€æ…‹ç®¡ç†**ï¼ˆç¬¬ 88-94 è¡Œï¼‰
5. **äº‹ä»¶è™•ç†**ï¼ˆç¬¬ 110-158 è¡Œï¼‰
6. **UI æ¸²æŸ“**ï¼ˆç¬¬ 160-381 è¡Œï¼‰

## ğŸ” è©³ç´°èªªæ˜

### 1. å¼•å…¥ä¾è³´

```1:18:App.tsx
import React, { useState, useMemo, useEffect } from 'react';
import { TabCategory, InputState, Language, Theme } from './types';
import { calculateResults } from './utils/calculations';
import { InputField } from './components/InputField';
import { ResultsDashboard } from './components/ResultsDashboard';
import { t } from './utils/i18n';
import {
  CalculatorIcon,
  BuildingOffice2Icon,
  BanknotesIcon,
  ChartPieIcon,
  TableCellsIcon,
  Bars3Icon,
  XMarkIcon,
  SunIcon,
  MoonIcon,
  GlobeAltIcon
} from '@heroicons/react/24/outline';
```

- **React Hooks**ï¼š`useState`ã€`useMemo`ã€`useEffect`
- **é¡å‹å®šç¾©**ï¼šå¾ `types.ts` å¼•å…¥
- **è¨ˆç®—å‡½æ•¸**ï¼šå¾ `utils/calculations.ts` å¼•å…¥
- **UI çµ„ä»¶**ï¼šè¼¸å…¥æ¬„ä½èˆ‡çµæœå„€è¡¨æ¿
- **åœ–ç¤º**ï¼šHeroicons åœ–ç¤ºåº«

### 2. é è¨­è³‡æ–™

#### é è¨­è¼¸å…¥å€¼

```20:53:App.tsx
const DEFAULT_INPUTS: InputState = {
  dihao: '',
  diduan: '',
  zoning: '',
  area: 0,
  roadwidth: 8,
  height: 0,
  bcRatio: 0,
  far: 0,
  excavate: 0,
  floors: 0,
  roofLayers: 0,
  basement: 0,
  mech: 0,
  stair: 0,
  balcony: 0,
  roof: 0,
  common: 33,
  parkSize: 8,
  buildCost: 250000,
  legalCost: 0,
  planFee: 0,
  evalFee: 0,
  boundaryFee: 0,
  drillFee: 0,
  neighborFee: 0,
  parkPrice: 2500000,
  price1F: 1000000,
  price2F: 800000,
  oldPing: 30,
  newUnits: 10,
  owners: 1,
  sellPercent: 0
};
```

- å®šç¾©æ‰€æœ‰è¼¸å…¥æ¬„ä½çš„åˆå§‹å€¼
- éƒ¨åˆ†æ¬„ä½æœ‰é è¨­å€¼ï¼ˆå¦‚ `roadwidth: 8`ã€`common: 33`ï¼‰

#### ç¯„ä¾‹è³‡æ–™

```56:78:App.tsx
const DEMO_INPUTS: InputState = {
  ...DEFAULT_INPUTS,
  area: 500, // m2
  bcRatio: 45, // %
  far: 225, // %
  excavate: 60, // %
  floors: 12,
  basement: 3,
  roofLayers: 2,
  mech: 10,
  stair: 10,
  balcony: 10,
  roof: 10,
  common: 34,
  buildCost: 280000,
  legalCost: 18000,
  parkPrice: 3000000,
  price1F: 1200000,
  price2F: 950000,
  oldPing: 40,
  newUnits: 12,
  sellPercent: 40
};
```

- ç”¨æ–¼å¿«é€Ÿæ¸¬è©¦çš„ç¯„ä¾‹è³‡æ–™
- å¯é€éã€Œè¼‰å…¥ç¯„ä¾‹è³‡æ–™ã€æŒ‰éˆ•è¼‰å…¥

#### åˆ†é å®šç¾©

```80:85:App.tsx
const TABS = [
  { id: TabCategory.BASIC, icon: BuildingOffice2Icon },
  { id: TabCategory.REGULATIONS, icon: TableCellsIcon },
  { id: TabCategory.COSTS, icon: BanknotesIcon },
  { id: TabCategory.SALES, icon: ChartPieIcon },
];
```

- å®šç¾©å››å€‹ä¸»è¦åˆ†é åŠå…¶å°æ‡‰åœ–ç¤º

### 3. ç‹€æ…‹ç®¡ç†

```87:94:App.tsx
export default function App() {
  const [inputs, setInputs] = useState<InputState>(DEFAULT_INPUTS);
  const [activeTab, setActiveTab] = useState<TabCategory>(TabCategory.BASIC);
  
  // Settings State
  const [isMenuOpen, setIsMenuOpen] = useState(false);
  const [lang, setLang] = useState<Language>('zh-TW');
  const [theme, setTheme] = useState<Theme>('light');
```

- **`inputs`**ï¼šæ‰€æœ‰è¼¸å…¥æ¬„ä½çš„ç‹€æ…‹
- **`activeTab`**ï¼šç•¶å‰å•Ÿç”¨çš„åˆ†é 
- **`isMenuOpen`**ï¼šè¨­å®šé¸å–®çš„é–‹é—œç‹€æ…‹
- **`lang`**ï¼šç•¶å‰èªè¨€ï¼ˆé è¨­ç¹é«”ä¸­æ–‡ï¼‰
- **`theme`**ï¼šç•¶å‰ä¸»é¡Œï¼ˆé è¨­æ·ºè‰²ï¼‰

### 4. è¨ˆç®—çµæœ

```96:96:App.tsx
  const results = useMemo(() => calculateResults(inputs), [inputs]);
```

- ä½¿ç”¨ `useMemo` å„ªåŒ–æ•ˆèƒ½ï¼Œåªåœ¨ `inputs` æ”¹è®Šæ™‚é‡æ–°è¨ˆç®—
- å°‡è¼¸å…¥è³‡æ–™å‚³å…¥è¨ˆç®—å‡½æ•¸ï¼Œå¾—åˆ°çµæœç‰©ä»¶

### 5. ä¸»é¡Œæ•ˆæœ

```99:105:App.tsx
  // Apply Theme Effect
  useEffect(() => {
    if (theme === 'dark') {
      document.documentElement.classList.add('dark');
    } else {
      document.documentElement.classList.remove('dark');
    }
  }, [theme]);
```

- ç•¶ä¸»é¡Œæ”¹è®Šæ™‚ï¼Œåœ¨ `<html>` å…ƒç´ ä¸Šæ·»åŠ æˆ–ç§»é™¤ `dark` é¡åˆ¥
- Tailwind CSS çš„æ·±è‰²æ¨¡å¼ä¾è³´æ­¤é¡åˆ¥

### 6. è¼¸å…¥è™•ç†å‡½æ•¸

#### å­—ä¸²/æ•¸å­—è¼¸å…¥è™•ç†

```110:118:App.tsx
  const handleInputStringChange = (key: keyof InputState) => (val: string) => {
    const isText = key === 'dihao' || key === 'diduan' || key === 'zoning';
    if (isText) {
      setInputs(prev => ({ ...prev, [key]: val }));
      return;
    }
    const parsed = val === '' ? 0 : parseFloat(val);
    setInputs(prev => ({ ...prev, [key]: Number.isNaN(parsed) ? 0 : parsed }));
  };
```

- æ–‡å­—æ¬„ä½ï¼ˆåœ°è™Ÿã€åœ°æ®µã€ä½¿ç”¨åˆ†å€ï¼‰ç›´æ¥æ›´æ–°
- æ•¸å­—æ¬„ä½è§£æç‚ºæµ®é»æ•¸ï¼Œç„¡æ•ˆå€¼è¨­ç‚º 0

#### è¼¸å…¥é©—è­‰èˆ‡é™åˆ¶

```120:153:App.tsx
  const percentKeys: (keyof InputState)[] = ['bcRatio', 'far', 'excavate', 'mech', 'stair', 'balcony', 'roof', 'common', 'sellPercent'];
  const integerKeys: (keyof InputState)[] = ['floors', 'basement', 'roofLayers', 'newUnits', 'owners'];
  const nonNegativeKeys: (keyof InputState)[] = [
    'area', 'roadwidth', 'height', 'bcRatio', 'far', 'excavate', 'floors', 'roofLayers', 'basement',
    'mech', 'stair', 'balcony', 'roof', 'buildCost', 'legalCost', 'planFee', 'evalFee', 'boundaryFee',
    'drillFee', 'neighborFee', 'common', 'parkSize', 'parkPrice', 'price1F', 'price2F', 'oldPing',
    'newUnits', 'owners', 'sellPercent'
  ];

  const clampOnBlur = (key: keyof InputState) => (raw: string) => {
    const isText = key === 'dihao' || key === 'diduan' || key === 'zoning';
    if (isText) return;

    let val = parseFloat(raw);
    if (Number.isNaN(val)) val = 0;

    if (nonNegativeKeys.includes(key)) {
      val = Math.max(0, val);
    }

    if (percentKeys.includes(key)) {
      val = Math.min(100, val);
    }

    if (integerKeys.includes(key)) {
      val = Math.floor(val);
    }

    if (key === 'parkSize' && val <= 0) {
      val = 8;
    }

    setInputs(prev => ({ ...prev, [key]: val }));
  };
```

- **ç™¾åˆ†æ¯”æ¬„ä½**ï¼šé™åˆ¶åœ¨ 0-100 ä¹‹é–“
- **æ•´æ•¸æ¬„ä½**ï¼šå–æ•´æ•¸éƒ¨åˆ†
- **éè² æ•¸æ¬„ä½**ï¼šç¢ºä¿ â‰¥ 0
- **ç‰¹æ®Šè™•ç†**ï¼š`parkSize` æœ€å°ç‚º 8

### 7. UI çµæ§‹

#### ä¸»è¦å®¹å™¨

```160:161:App.tsx
    <div className="min-h-screen font-sans text-slate-800 dark:text-slate-100 bg-slate-100 dark:bg-slate-900 transition-colors duration-300">
```

- å…¨è¢å¹•å®¹å™¨ï¼Œæ”¯æ´æ·±è‰²æ¨¡å¼

#### è¨­å®šé¸å–®ï¼ˆæŠ½å±œï¼‰

```164:227:App.tsx
      {/* DRAWER / SIDEBAR */}
      <div className={`fixed inset-0 z-[100] transition-opacity duration-300 ${isMenuOpen ? 'opacity-100 pointer-events-auto' : 'opacity-0 pointer-events-none'}`}>
        {/* Backdrop */}
        <div className="absolute inset-0 bg-slate-900/50 backdrop-blur-sm transition-opacity" onClick={() => setIsMenuOpen(false)}></div>
        
        {/* Drawer Content */}
        <div className={`absolute top-0 left-0 h-full w-80 bg-white dark:bg-slate-800 shadow-2xl transform transition-transform duration-300 flex flex-col ${isMenuOpen ? 'translate-x-0' : '-translate-x-full'}`}>
```

- å¾å·¦å´æ»‘å‡ºçš„è¨­å®šé¸å–®
- åŒ…å«èªè¨€é¸æ“‡èˆ‡ä¸»é¡Œåˆ‡æ›

#### æ¨™é¡Œåˆ—

```230:256:App.tsx
      {/* Header */}
      <header className="bg-slate-900 dark:bg-slate-950 text-white sticky top-0 z-40 shadow-md transition-colors duration-300">
        <div className="max-w-[1600px] mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
          <div className="flex items-center space-x-4">
            <button 
              onClick={() => setIsMenuOpen(true)}
              className="p-2 rounded-lg hover:bg-slate-800 transition-colors"
            >
              <Bars3Icon className="w-6 h-6 text-slate-300 hover:text-white" />
            </button>
            <div className="flex items-center space-x-3">
              <div className="bg-primary-600 p-2 rounded-lg shadow-lg shadow-primary-900/20">
                <CalculatorIcon className="h-6 w-6 text-white" />
              </div>
              <div>
                <h1 className="text-lg font-bold tracking-tight">{txt('app.title')}</h1>
                <p className="hidden sm:block text-[10px] text-slate-400 font-light uppercase tracking-widest">{txt('app.subtitle')}</p>
              </div>
            </div>
          </div>
          <button 
            onClick={loadDemo}
            className="text-xs font-medium bg-slate-800 hover:bg-slate-700 px-3 py-1.5 rounded-md border border-slate-700 transition-colors hover:text-primary-300"
          >
            {txt('action.loadDemo')}
          </button>
        </div>
      </header>
```

- å›ºå®šç½®é ‚çš„æ¨™é¡Œåˆ—
- å·¦å´ï¼šé¸å–®æŒ‰éˆ•ã€æ‡‰ç”¨ç¨‹å¼æ¨™é¡Œ
- å³å´ï¼šè¼‰å…¥ç¯„ä¾‹è³‡æ–™æŒ‰éˆ•

#### ä¸»è¦å…§å®¹å€

```258:380:App.tsx
      <main className="max-w-[1600px] mx-auto p-4 sm:p-6 lg:p-8">
        <div className="flex flex-col lg:flex-row gap-8">
          
          {/* LEFT COLUMN: Input Section */}
          <div className="w-full lg:w-5/12 xl:w-4/12 flex flex-col h-[calc(100vh-8rem)] lg:sticky lg:top-24">
            
            {/* Tabs */}
            <div className="flex space-x-1 bg-slate-100 dark:bg-slate-800/50 p-1.5 rounded-xl mb-4 overflow-x-auto custom-scrollbar transition-colors">
```

- å·¦å³åˆ†æ¬„å¸ƒå±€
- å·¦å´ï¼šè¼¸å…¥è¡¨å–®ï¼ˆå¯æ»¾å‹•ã€ç½®é ‚ï¼‰
- å³å´ï¼šçµæœå±•ç¤º

#### åˆ†é åˆ‡æ›

```265:286:App.tsx
            <div className="flex space-x-1 bg-slate-100 dark:bg-slate-800/50 p-1.5 rounded-xl mb-4 overflow-x-auto custom-scrollbar transition-colors">
              {TABS.map((tab) => {
                const Icon = tab.icon;
                const isActive = activeTab === tab.id;
                return (
                  <button
                    key={tab.id}
                    onClick={() => setActiveTab(tab.id)}
                    className={`
                      flex-1 flex items-center justify-center space-x-2 px-3 py-2.5 rounded-lg text-sm font-semibold transition-all duration-200 min-w-[100px]
                      ${isActive 
                        ? 'bg-white dark:bg-slate-700 text-slate-900 dark:text-white shadow-sm ring-1 ring-black/5 dark:ring-white/5' 
                        : 'text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-200 hover:bg-slate-200/50 dark:hover:bg-slate-700/50'
                      }
                    `}
                  >
                    <Icon className={`w-4 h-4 ${isActive ? 'text-primary-600 dark:text-primary-400' : 'text-slate-400 dark:text-slate-500'} transition-colors`} />
                    <span>{txt(tab.id)}</span>
                  </button>
                );
              })}
            </div>
```

- å››å€‹åˆ†é æŒ‰éˆ•
- æ ¹æ“š `activeTab` ç‹€æ…‹é¡¯ç¤ºå•Ÿç”¨æ¨£å¼

#### è¼¸å…¥è¡¨å–®å…§å®¹

æ ¹æ“š `activeTab` é¡¯ç¤ºä¸åŒçš„è¼¸å…¥æ¬„ä½ï¼š

- **åŸºæœ¬åƒæ•¸**ï¼ˆ`TabCategory.BASIC`ï¼‰ï¼šåœŸåœ°èˆ‡å»ºç¯‰åƒæ•¸
- **å®¹ç©è¦è²»**ï¼ˆ`TabCategory.REGULATIONS`ï¼‰ï¼šå…è¨ˆå®¹ç©ä¸Šé™
- **æˆæœ¬ä¼°ç®—**ï¼ˆ`TabCategory.COSTS`ï¼‰ï¼šæˆæœ¬åƒæ•¸èˆ‡è¦è²»
- **éŠ·å”®æ¬Šç›Š**ï¼ˆ`TabCategory.SALES`ï¼‰ï¼šéŠ·å”®èˆ‡æ¬Šç›Šè¨­å®š

#### çµæœå±•ç¤ºå€

```375:377:App.tsx
          {/* RIGHT COLUMN: Results */}
          <div className="w-full lg:w-7/12 xl:w-8/12">
            <ResultsDashboard results={results} lang={lang} theme={theme} />
          </div>
```

- å‚³å…¥è¨ˆç®—çµæœã€èªè¨€èˆ‡ä¸»é¡Œ
- ç”± `ResultsDashboard` çµ„ä»¶è² è²¬æ¸²æŸ“

## ğŸ”— ç›¸é—œæª”æ¡ˆ

- [é¡å‹å®šç¾©](./05-é¡å‹å®šç¾©.md) - `InputState`ã€`TabCategory` ç­‰é¡å‹
- [è¨ˆç®—é‚è¼¯](./06-è¨ˆç®—é‚è¼¯.md) - `calculateResults` å‡½æ•¸
- [åœ‹éš›åŒ–](./07-åœ‹éš›åŒ–.md) - `t` ç¿»è­¯å‡½æ•¸
- [è¼¸å…¥çµ„ä»¶](./08-è¼¸å…¥çµ„ä»¶.md) - `InputField` çµ„ä»¶
- [çµæœå„€è¡¨æ¿](./09-çµæœå„€è¡¨æ¿.md) - `ResultsDashboard` çµ„ä»¶

